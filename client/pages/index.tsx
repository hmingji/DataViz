import { ChevronDown } from '@/components/common/Icons/ChevronDown';
import LineChart from '@/components/common/LineChart';
import MultiSelectListBox from '@/components/common/MultiSelectListBox';
import SelectionGroup from '@/components/common/SelectionGroup';
import { Attribute, attributes } from '@/constants/attributes';
import { Interval, intervals } from '@/constants/intervals';
import { State, states } from '@/constants/states';
import { useRecordQuery } from '@/hooks/useRecordQuery';
import { ChartOptions } from 'chart.js';
import Head from 'next/head';
import { useRef, useState } from 'react';
//import { Inter } from '@next/font/google';
import DropdownMenu from '../components/common/DropdownMenu';
//const inter = Inter({ subsets: ['latin'] });
export default function Home() {
  const [attribute, setAttribute] = useState<Attribute>(attributes[0]);
  const [interval, setInterval] = useState<Interval>(intervals[0]);
  const [state, setState] = useState<State[]>([states[0]]);
  const url = useRef(
    `Record/${attribute.category}/${interval.pathName}/${attribute.pathName}`
  );
  const results = useRecordQuery(url.current, state);

  const options: ChartOptions<'line'> = {
    responsive: true,
    scales: {
      x: {
        type: 'time',
        time: {
          unit: 'year',
        },
      },
      y: {
        beginAtZero: true,
      },
    },
  };

  function handleDropdownOnClick(item: Attribute) {
    setAttribute(item);
  }

  if (results[0].isSuccess) {
    const finalData = results[0].data.data.map((item) => {
      const date = new Date(item.date);
      const dateInMsWithoutTZ =
        date.getTime() + date.getTimezoneOffset() * 60 * 1000;
      return {
        x: dateInMsWithoutTZ,
        y: item.value,
      };
    });

    const chartdata = {
      datasets: [
        {
          label: 'yearly',
          data: finalData,
          backgroundColor: 'rgba(255, 99, 132, 0.5)',
          borderColor: 'rgb(255, 99, 132)',
          borderWidth: 1,
        },
      ],
    };

    return (
      <>
        <Head>
          <title>Create Next App</title>
          <meta
            name="description"
            content="Generated by create next app"
          />
          <meta
            name="viewport"
            content="width=device-width, initial-scale=1"
          />
          <link
            rel="icon"
            href="/favicon.ico"
          />
        </Head>
        <main>
          <h1 className="text-black">Hello World!</h1>

          {/* <div className="w-full flex gap-8 px-2">
            <DropdownMenu
              buttonLabel="Attribute"
              menuItems={['Daily', 'Blood A']}
              handleOnClick={handleDropdownOnClick}
              buttonIcon={<ChevronDown size="sm" />}
              selectedItem={selected}
            />

            <SelectionGroup
              options={[
                { id: 1, label: 'Daily' },
                { id: 2, label: 'Monthly' },
                { id: 3, label: 'Yearly' },
              ]}
              handleOnChange={setInterval}
              value={interval}
            />

            <MultiSelectListBox
              buttonLabel="States"
              options={[
                { id: 1, label: 'Kuala Lumpur' },
                { id: 2, label: 'Melaka' },
                { id: 3, label: 'Johor' },
                { id: 4, label: 'Sarawak' },
              ]}
              handleOnChange={setStates}
              value={states}
              optionWithIcon={false}
            />
          </div>
          <div className="max-w-fit">
            <LineChart
              chartData={chartdata}
              options={options}
            />
          </div> */}
        </main>
      </>
    );
  }
}
